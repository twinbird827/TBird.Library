<Controls:MetroWindow x:Class="Netkeiba.MainWindow"
					  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
					  xmlns:Controls="http://metro.mahapps.com/winfx/xaml/controls"
					  xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
					  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
					  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
					  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
					  xmlns:local="clr-namespace:Netkeiba"
					  xmlns:behavior="clr-namespace:TBird.Wpf.Behaviors;assembly=TBird.Wpf"
					  behavior:WindowBehavior.ContentRendered="{Binding OnLoaded}"
					  behavior:WindowBehavior.Closing="{Binding OnClosing}"
					  mc:Ignorable="d"
                      Title="Netkeiba">
	<Controls:MetroWindow.DataContext>
		<local:MainViewModel />
	</Controls:MetroWindow.DataContext>
	<Controls:MetroWindow.Resources>

		<Style TargetType="GroupBox">
			<Setter Property="Margin" Value="10" />
		</Style>

		<Style TargetType="ProgressBar">
			<Setter Property="Margin" Value="0" />
		</Style>

		<Style TargetType="TextBlock">
			<Setter Property="Margin" Value="3" />
			<Setter Property="MinWidth" Value="60" />
			<Setter Property="VerticalAlignment" Value="Center" />
		</Style>

		<Style TargetType="TextBox">
			<Setter Property="Margin" Value="3" />
			<Setter Property="Padding" Value="3" />
			<Setter Property="MinWidth" Value="60" />
			<Setter Property="VerticalAlignment" Value="Center" />
			<Setter Property="VerticalContentAlignment" Value="Center" />
		</Style>

		<Style TargetType="CheckBox">
			<Setter Property="Margin" Value="3" />
			<Setter Property="MinWidth" Value="60" />
			<Setter Property="VerticalAlignment" Value="Center" />
		</Style>

		<Style TargetType="Button">
			<Setter Property="Margin" Value="3" />
			<Setter Property="MinWidth" Value="40" />
			<Setter Property="MinHeight" Value="40" />
		</Style>

		<Style TargetType="ListBox">
			<Setter Property="Margin" Value="5" />
		</Style>
	</Controls:MetroWindow.Resources>

	<DockPanel>

		<StatusBar DockPanel.Dock="Bottom">

			<Button DockPanel.Dock="Right"
                    Content="{iconPacks:Material Kind=Cog}"
					Command="{Binding ClickSetting}" />

			<Controls:MetroProgressBar Width="300"
									   Margin="5,0"
									   VerticalAlignment="Stretch"
									   VerticalContentAlignment="Stretch"
						               Value="{Binding Progress.Value}"
						               Maximum="{Binding Progress.Maximum}"
						               Minimum="{Binding Progress.Minimum}" />

			<TextBlock VerticalAlignment="Center"
					   Text="{Binding Progress.Ratio, StringFormat={}{0:P2}}" />
		</StatusBar>

		<GroupBox Header="実行ログ" DockPanel.Dock="Bottom" Height="150">
			<ListBox ItemsSource="{Binding Logs}"
					 behavior:ListBoxBehavior.CopyToClipboard="True">
				<ItemsControl.ItemsPanel>
					<ItemsPanelTemplate>
						<StackPanel Orientation="Vertical" />
					</ItemsPanelTemplate>
				</ItemsControl.ItemsPanel>
				<ItemsControl.ItemTemplate>
					<DataTemplate>
						<DockPanel>
							<TextBlock Text="{Binding Value}" DockPanel.Dock="Left" Width="150" />
							<TextBlock Text="{Binding Display}" />
						</DockPanel>
					</DataTemplate>
				</ItemsControl.ItemTemplate>
			</ListBox>
		</GroupBox>

		<Grid DockPanel.Dock="Left">
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="200" />
			</Grid.ColumnDefinitions>
			<Grid.RowDefinitions>
				<RowDefinition Height="auto" />
				<RowDefinition Height="auto" />
				<RowDefinition Height="auto" />
			</Grid.RowDefinitions>

			<GroupBox Header="STEP1: データ収集" Grid.Row="0">
				<StackPanel Orientation="Vertical">

					<TextBlock Text="開始" />

					<TextBox Text="{Binding SYear, Converter={StaticResource Int2StringConverter}}" />

					<TextBlock Text="終了" />

					<TextBox Text="{Binding EYear, Converter={StaticResource Int2StringConverter}}" />

					<CheckBox IsChecked="{Binding S1Overwrite.IsChecked}" Content="上書きする" />

					<Button Content="実行" Command="{Binding S1EXEC}" />

					<Button Content="データ補完" Command="{Binding S3EXECPREDICT}" />
				</StackPanel>
			</GroupBox>

			<GroupBox Header="STEP2: 学習用データ作成" Grid.Row="1">
				<StackPanel Orientation="Vertical">

					<CheckBox IsChecked="{Binding S2Overwrite.IsChecked}" Content="上書きする" />

					<Button Content="実行" Command="{Binding S2EXEC}" />
				</StackPanel>
			</GroupBox>

			<GroupBox Header="STEP3: 学習実行" Grid.Row="2">
				<StackPanel Orientation="Vertical">

					<Button Content="モデル作成" Command="{Binding S3EXEC}" />
				</StackPanel>
			</GroupBox>
		</Grid>

		<GroupBox Header="STEP4: データ予測" DockPanel.Dock="Left">
			<Grid DockPanel.Dock="Left">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="auto" />
					<ColumnDefinition Width="200" />
				</Grid.ColumnDefinitions>
				<Grid.RowDefinitions>
					<RowDefinition Height="auto" />
					<RowDefinition Height="auto" />
					<RowDefinition Height="*" />
				</Grid.RowDefinitions>

				<Button Grid.Row="0" Grid.Column="0"
                    Content="{iconPacks:Material Kind=Update}"
					Command="{Binding S4UPDATELIST}" />

				<ComboBox Grid.Row="0" Grid.Column="1"
					  ItemsSource="{Binding S4Dates.Items}"
					  SelectedItem="{Binding S4Dates.SelectedItem}" />

				<ItemsControl Grid.Row="1" Grid.ColumnSpan="2"
						  ItemsSource="{Binding S4RoundHeader.Columns}">
					<ItemsControl.ItemsPanel>
						<ItemsPanelTemplate>
							<UniformGrid Columns="{Binding S4RoundHeader.ColumnCount}" />
						</ItemsPanelTemplate>
					</ItemsControl.ItemsPanel>
					<ItemsControl.ItemTemplate>
						<DataTemplate>
							<Label Content="{Binding Display}" />
						</DataTemplate>
					</ItemsControl.ItemTemplate>
				</ItemsControl>

				<ItemsControl Grid.Row="2" Grid.ColumnSpan="2"
							  ItemsSource="{Binding S4RoundItems}">
					<ItemsControl.ItemsPanel>
						<ItemsPanelTemplate>
							<StackPanel Orientation="Vertical" />
						</ItemsPanelTemplate>
					</ItemsControl.ItemsPanel>
					<ItemsControl.ItemTemplate>
						<DataTemplate>
							<ItemsControl ItemsSource="{Binding Columns}">
								<ItemsControl.ItemsPanel>
									<ItemsPanelTemplate>
										<UniformGrid Columns="{Binding ColumnCount}" />
									</ItemsPanelTemplate>
								</ItemsControl.ItemsPanel>
								<ItemsControl.ItemTemplate>
									<DataTemplate>
										<RadioButton Content="{Binding Display}" IsChecked="{Binding IsChecked}" GroupName="S4Items" />
									</DataTemplate>
								</ItemsControl.ItemTemplate>
							</ItemsControl>
						</DataTemplate>
					</ItemsControl.ItemTemplate>
				</ItemsControl>
			</Grid>
		</GroupBox>

		<GroupBox Header="{Binding S4ResultHeader}">
			<ListView ItemsSource="{Binding S4ResultItems}">
				<ListView.View>
					<GridView>
						<GridViewColumn Header="枠番"
										DisplayMemberBinding="{Binding Wakuban}" />
						<GridViewColumn Header="馬番"
										DisplayMemberBinding="{Binding Umaban}" />
						<GridViewColumn Header="馬名"
										DisplayMemberBinding="{Binding Name}" />
						<GridViewColumn Header="着順"
										DisplayMemberBinding="{Binding Result}" />
						<GridViewColumn Header="予想"
										DisplayMemberBinding="{Binding Rank}" />
						<GridViewColumn Header="スコア"
										DisplayMemberBinding="{Binding Score, StringFormat={}{0:N4}}" />
						<GridViewColumn Header="自信"
										DisplayMemberBinding="{Binding Confidence, StringFormat={}{0:N4}}" />
					</GridView>
				</ListView.View>
			</ListView>
		</GroupBox>
	</DockPanel>
</Controls:MetroWindow>